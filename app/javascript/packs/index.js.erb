import React, {useEffect, useState} from 'react'
import ReactDOM from 'react-dom'
import App from "../base/App";
import I18n from "i18n-js"; import Loader from "../base/Loader"; import Api from "../base/Api";

I18n.translations = <%= I18n::JS.translations.to_json %>;

async function fetchUser() {
    const response = await Api({path: '/hi'});
    const user = await response.json();
    if (user.username && user.bio) {
        console.log(I18n.t('console.authorized') + JSON.stringify(user));
        return user;
    } else {
        console.error(I18n.t('console.error') + ' Unknown JSON returned: ' + JSON.stringify(user)) // TODO: error handling
        return undefined;
    }
}

/* React entrypoint */
document.addEventListener('DOMContentLoaded', () => {
    Promise.all([fetchUser()]).then(([user]) => {
        ReactDOM.render(<App account={user}/>, document.getElementById('app'), () => {
            const loader = document.getElementById('loader');
            if (loader.classList.contains('initial')) {
                loader.remove();
            }
        });

    });
});
